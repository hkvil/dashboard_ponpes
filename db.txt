-- =========================
-- ENUM TYPES
-- =========================
CREATE TYPE nama_madrasah_enum AS ENUM (
  'TK_AL_ITTIFAQIAH',
  'TPQ_AL_ITTIFAQIAH',
  'MD_AL_ITTIFAQIAH',
  'MI_AL_ITTIFAQIAH',
  'MTS1_AL_ITTIFAQIAH',
  'MTS2_AL_ITTIFAQIAH',
  'MA1_AL_ITTIFAQIAH',
  'MA2_AL_ITTIFAQIAH',
  'IAIQI'
);

CREATE TYPE semester_ajaran_enum AS ENUM ('GANJIL','GENAP');

CREATE TYPE kategori_personil_enum AS ENUM ('GURU','PENGURUS','STAFF');

CREATE TYPE kategori_status_guru_enum AS ENUM ('BARU','RESIGN');

CREATE TYPE jk_enum AS ENUM ('L','P');

CREATE TYPE status_kepegawaian_enum AS ENUM ('PNS','GTY','GTTY','HONORER','KONTRAK','LAINNYA');

CREATE TYPE status_keaktifan_enum AS ENUM ('AKTIF','NONAKTIF','CUTI');

CREATE TYPE pendidikan_enum AS ENUM ('SD','SMP','SMA','D1','D2','D3','D4','S1','S2','S3','LAINNYA');

CREATE TYPE tingkat_lomba_enum AS ENUM ('SEKOLAH','KECAMATAN','KABUPATEN','PROVINSI','NASIONAL','INTERNASIONAL');

CREATE TYPE kategori_lomba_enum AS ENUM ('AKADEMIK','NONAKADEMIK','OLAHRAGA','SENI','AGAMA','LAINNYA');


-- =========================
-- TABLES
-- =========================

-- SANTRI
CREATE TABLE santri (
  id_santri       BIGSERIAL PRIMARY KEY,

  -- Info Madrasah / Lembaga
  nama_madrasah   nama_madrasah_enum,
  tahun_pelajaran VARCHAR(20),
  alamat_madrasah VARCHAR(200),
  kabupaten_kota_madrasah VARCHAR(150),
  madrasah_induk  VARCHAR(150),

  -- Identitas & nomor
  nomor_urut      INTEGER,
  nomor_induk     VARCHAR(20),
  nisn            VARCHAR(10),

  -- Data santri
  foto_url        TEXT,
  nama_santri     VARCHAR(120) NOT NULL,
  jenis_kelamin   jk_enum,
  kelas           VARCHAR,          -- bebas, e.g. '7A'

  -- Lahir
  tempat_lahir    VARCHAR(100),
  tanggal_lahir   DATE,
  tgl_lahir       SMALLINT CHECK (tgl_lahir BETWEEN 1 AND 31),
  bln_lahir       SMALLINT CHECK (bln_lahir BETWEEN 1 AND 12),
  thn_lahir       SMALLINT CHECK (thn_lahir BETWEEN 1900 AND 2100),

  -- Orang tua
  ayah            VARCHAR(120),
  ibu             VARCHAR(120),

  -- Alamat siswa
  desa_kelurahan  VARCHAR(120),
  kecamatan       VARCHAR(120),
  kabupaten_kota  VARCHAR(120),
  alamat_lengkap  TEXT,

  -- Ijazah
  ijazah_nomor    VARCHAR(50),
  ijazah_tahun    SMALLINT CHECK (ijazah_tahun BETWEEN 1900 AND 2100),

  -- Status
  lulus           BOOLEAN
);

-- GURU
CREATE TABLE guru (
  id_guru           BIGSERIAL PRIMARY KEY,
  no_urut           INTEGER,
  profil_url        TEXT,

  -- Info Madrasah / Lembaga
  jenis_unit        nama_madrasah_enum,
  nama_madrasah     VARCHAR(150),
  tahun_pelajaran   VARCHAR(20),
  semester          semester_ajaran_enum,

  -- Identitas
  nama_lengkap      VARCHAR(120) NOT NULL,
  tempat_lahir      VARCHAR(100),
  tanggal_lahir     DATE,
  jenis_kelamin     jk_enum,
  agama             VARCHAR(20),

  -- Kontak & keluarga
  no_telp           VARCHAR(25),
  nama_ibu          VARCHAR(120),

  -- Dokumen
  nik_passport      VARCHAR(32),

  -- Kepegawaian
  kategori_personil kategori_personil_enum,
  keterangan_tugas  VARCHAR(150),
  status_kepegawaian status_kepegawaian_enum,
  mulai_bertugas    DATE,
  status_keaktifan  status_keaktifan_enum,

  -- Pendidikan
  pendidikan_terakhir pendidikan_enum,
  lulusan           VARCHAR(120),
  linier            BOOLEAN,

  -- Status & Sertifikasi
  status_pns        BOOLEAN,
  guru_tetap        BOOLEAN,
  sertifikasi       TEXT,
  sertifikasi_non_madrasah TEXT
);

-- PRESTASI (santri)
CREATE TABLE prestasi (
  id_prestasi   INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  id_santri     BIGINT REFERENCES santri(id_santri) ON DELETE CASCADE,
  nama          VARCHAR,        -- nama lomba
  kelas         VARCHAR,
  bidang_lomba  VARCHAR,
  penyelenggara VARCHAR,
  tingkat       tingkat_lomba_enum,
  peringkat     SMALLINT,
  kategori      kategori_lomba_enum,
  tahun         SMALLINT CHECK (tahun BETWEEN 1900 AND 2100)
);

-- PELANGGARAN (santri)
CREATE TABLE pelanggaran (
  id_pelanggaran BIGSERIAL PRIMARY KEY,
  id_santri      BIGINT NOT NULL REFERENCES santri(id_santri) ON DELETE CASCADE,
  jenis_pelanggaran VARCHAR,
  poin           SMALLINT,
  total_poin     INTEGER,
  keterangan     VARCHAR,
  tanggal        DATE
);



-- Helpful indexes on FKs
CREATE INDEX idx_prestasi_id_santri   ON prestasi(id_santri);
CREATE INDEX idx_pelanggaran_id_santri ON pelanggaran(id_santri);
